@startuml
!define DEVICONS https://raw.githubusercontent.com/tupadr3/plantuml-icon-font-sprites/master/devicons
!include DEVICONS/postgresql.puml

entity User {
    + id: int
    --
    username: String
    email: String
    password_hash: String
    role: String [admin, user]
    created_at: DateTime
    updated_at: DateTime
}

entity Home {
    + id: int
    --
    name: String
    description: String
    address: String
    user_id: int
    created_at: DateTime
    updated_at: DateTime
}

entity Device {
    + id: int
    --
    name: String
    description: String
    attributes: jsonb
    home_id: int
    status: String [on, off]
    device_type_id: int
    created_at: DateTime
    updated_at: DateTime
}

entity DeviceType {
    + id: int
    --
    name: String
    description: String
}

entity Sensor {
    + id: int
    --
    device_name: String
    name: String
    telemetry_type_id: int
    created_at: DateTime
}

entity TelemetryType {
    + id: int
    --
    name: String [temperature, brightness, doorStatus, gateStatus]
    description: String
}

entity TelemetryRecord {
    + id: int
    --
    data: jsonb
    sensor_id: int
    created_at: DateTime
}

entity TelemetryViewRecord {
    + id: int
    --
    sensor_id: int
    attributes: jsonb
    created_at: DateTime
}

User ||--o{ Home : "owns"
Home ||--o{ Device : "contains"
Device ||--o{ Sensor : "monitors"
Sensor ||--o| TelemetryType : "uses"
Sensor ||--o{ TelemetryRecord : "generates"
Sensor ||--o{ TelemetryViewRecord : "creates"
DeviceType ||--o{ Device : "categorizes"

@enduml
